<div class="flex flex-column gap-4 md:flex-row md:justify-content-between align-items-center p-5">
    <div class="text-center md:text-left">
        <h1 class="title">Mis presupuestos</h1>
        <p class="subtitle">maneja y administra tus <span class="blue"> presupuestos</span></p>
    </div>
    <p-button [routerLink]="'new'" label="Nuevo" icon="pi pi-plus" [raised]="true"></p-button>
</div>
@if (!state().loadingData) {
    @if (budgets().length) {
        <div class="flex flex-column align-items-center gap-3">
            @for (budget of visibleBudgets(); track $index) {
                <app-card-info [titleKey]="budget.name" [detailRoute]="routes.detailRoute" [id]="budget._id" [amount]="budget.amount" [data]="budget" (onClick)="openPopover($event.event, $event.data, popover)" />
            }
            <div class="card flex justify-center">
                <p-paginator [totalRecords]="budgets().length" [rows]="rowsPerPage()" [rowsPerPageOptions]="[1, 2, 3, 4, 5, 10]" (onPageChange)="onPageChange($event)" />
            </div>
        </div>
    } @else {
        <p class="text-center">No cuentas con presupuestos, <span class="blue">crea uno nuevo</span></p>
    }
} @else {
    <app-spinner />
}

<p-popover #popover>
    <div class="flex flex-column gap-4">
        <div>
            <ul class="list-none p-0 m-0 flex flex-column">
                <li class="flex items-center gap-2 px-2 py-3 hover:bg-emphasis cursor-pointer rounded-border">
                    <i class="pi pi-pen-to-square"></i>
                    <div>
                        <a class="text-sm text-surface-500 dark:text-surface-400" [routerLink]="[routes.updateRoute, selectedBudget()?._id]">Actualizar</a>
                    </div>
                </li>
                <li class="flex items-center gap-2 px-2 py-3 hover:bg-emphasis cursor-pointer rounded-border" (click)="openDeleteDialog()">
                    <i class="pi pi-trash red"></i>
                    <div>
                        <div class="text-sm text-surface-500 dark:text-surface-400 red">Eliminar</div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</p-popover>

<p-dialog
    header="Eliminar presupuesto"
    [visible]="deleteDialogVisible()"
    [modal]="true"
    [closable]="false"
    [style]="{ width: '30rem' }"
>
    <p class="font-bold">Ingresa tu contraseña para <span class="blue">eliminar presupuesto</span></p>
    <p class="text-xs">(Un presupuesto eliminado y sus gastos no se pueden recuperar)</p>
    <form [formGroup]="form" class="pt-5">
        <p-floatlabel>
            <p-password inputId="password" [toggleMask]="true" [feedback]="false" fluid formControlName="password" />
            <label for="password">Contraseña</label>
        </p-floatlabel>
    </form>
    <div class="flex justify-content-end gap-2 mt-4">
        <p-button label="Cancelar" severity="secondary" (onClick)="cancelDelete()" styleClass="p-button-text"  />
        <p-button [label]="deleteLoading() ? 'Eliminando...' : 'Eliminar'" severity="danger" icon="pi pi-trash" (onClick)="onDelete()" [disabled]="form.invalid" [loading]="deleteLoading()" />
    </div>
</p-dialog>
